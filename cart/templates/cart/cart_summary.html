
{% extends 'products/base.html' %}    
{% block body %}
{% block head_extra %}
<style>
    .old-price {
        background: repeating-linear-gradient(45deg, rgba(50,50,50,100), rgba(50,50,50,100), transparent 1px, transparent 9px);
        padding: 5px;
    }
  
</style>
{% endblock %}

<body>
</br>

    <h4 class=" bi-cart-check text-center "> سبدخرید </h4>

    {% if cart_products %}
    {% for product in cart_products %} 
        <div class="container-fluid  mt-5">
            <div class="row mx-2">
                <div class="col-12 col-md-8 mx-auto">
                    <div class="border border-1 rounded-3 d-flex  shadow bg-white">

                        <div class="text-center col-12 col-md-3">
                            <img class="img-fluid  " src="{{product.image.url}}" alt="">
                        </div>

                        <!-- moshakhasat zire esm mahsol-->
                        <div class="d-block justify-content-start  ">
                            <div class=" mb-1 ">
                            <p class="fs-5 mt-2 fw-bold">
                                <i class="bi bi-caret-left-fill text-danger"></i>
                                {{ product.name }}
                            </p>
                            
                            <div class="d-grid">
                                <span class=" text-colorforbuy"><i class="bi bi-circle-fill text-dark"></i> سیاه</span>                       
                            </div>
                            <!-- NESHAN DAHANDE TEDAD -->
                            <div class="d-flex mt-1">                         
                                <span class=" text-muted mb-4 pb-2"><i class="bi bi-clipboard-check text-danger"></i> تعداد : </span>
                                {% for key, value in quantities.items %}
                                {% if key == product.id|slugify %}
                                <option class="mx-1" selected>{{ value }}</option>
                                {% endif %}
                                {% endfor %}
                            </div>

                            <!-- QEIMAT -->
                            <div class="d-flex ">
                                {% if product.in_sale %} 
                                <div class="d-grid text-center">
                                    <div class="shadow bg-light mx-5 mt-1 mb-3">

                                        <p>قیمت قبلی: <span class="old-price text-dark fw-bold">{{ product.price }}</span></p>
                                        <span class=" fw-bold fs-5 text-colorforbuyLow   ">
                                                {{ product.sale_price }} 

                                            <span class="text-colorforbuyLow">
                                                <small>تومان</small>
                                            </span>
                                        </span>

                                    </div>
                                </div>

                                {% else %}

                                    <span class=" fw-bold fs-5 text-colorforbuyLow mx-1 ">
                                         قیمت: {{ product.price }} 
                                        <span class="text-colorforbuyLow">
                                            <small>تومان</small>
                                        </span>
                                    </span>

                                {% endif %}  

                            </div>
                        </div>

                            <div class="d-flex justify-content-end">
                            
                                <td class="align-middle border-bottom-3 ">
                                    <div class="d-grid">
                                        <div class="d-flex flex-row mx-1">
                                            <button class="btn px-3 rounded-pill text-center" onclick="this.parentNode.querySelector('input[type=number]').stepDown()">
                                             <i class="bi bi-dash-circle h4 text-color1"></i>
                                            </button>
    
                                            <input id="select{{product.id}}" min="0" max="5" name="quantity" value="1" type="number" class="form-control form-control-sm" style="width: 90px; height:50px;" />
                                            <button class="btn px-3 text-color1 text-center rounded-pill" onclick="this.parentNode.querySelector('input[type=number]').stepUp()">
                                                <i class="bi h4 mt-2 bi-plus-circle"> </i>
                                            </button>
                                            <button type="button" data-index="{{product.id}}" class="update-cart btn text-color1 fw-bold btn-outline-danger mt-1 mx-1 mb-1">به روز رسانی تعداد <i class="bi mx-1 fw-bold  bi-arrow-down-square "></i></button>
                                            <button type="button " data-index="{{product.id}}" class="delete-product btn text-color1 btn-outline-danger mt-1 mx-1 mb-1"> <i class="bi mx-1  bi-trash3"></i></button>
                                            
                                        </div> 
                    
                                    </div>    

                                </td>                         
                            </div>

                        </div>
                    </div>
                </div>
                {% endfor %}
                <!-- box sorat hesab -->
                <div class="col-12 col-md-11 mx-auto">
                    <br>

                    <div class="text-center">
                        <button class="btn fw-bold fs-5">صورت حساب</button>
                    </div>

                    <div class="shadow bg-white rounded-4 ">

                        <div class="d-flex justify-content-between">
                            <span class="text-colorforbuyLow mx-4 mt-3">
                                <small>
                                    قیمت محصول
                                </small>
                            </span>

                            <span class="text-colorforbuyLow mx-3 mt-3">
                                <small>200,000 <span>تومان</span>
                                </small>
                            </span>
                        </div>

                        <div class="d-flex justify-content-between">
                            <span class="text-color1 mx-4 mt-3">
                                <small>
                                    تخفیف شما
                                </small>
                            </span>

                            <span class="text-color1 mx-3 mt-3">
                                <small>20,000 <span>تومان</span>
                            </small>
                            </span>
                        </div>

                        <div class="d-flex justify-content-between">
                            <span class="text-colorforbuyLow mx-4 mt-3 fw-bold" > قیمت نهایی </span>
                            <span class="text-colorforbuyLow mx-3 mt-3 fw-bold"> {{ totals }} تومان </span>
                        </div>

                        <div class="d-grid gap-2 mt-4 mx-3 ">
                            <button type="button" class="btn btn-danger color1 rounded-2 mb-1 ">ادامه خرید</button>
                            <button class="btn text-color1 fw-bold btn-outline-danger " onclick="window.location.href='{% url 'product_list'%}'"> بازگشت به صفحه اصلی <i class="bi mx-1"></i></button>

                        </div>

                    </div>
                    
                </div>
            </div>
        </div>



{% else %}

  <h5 class="text-bg-warning">در سبد شما کالایی وجود ندارد <h5>
    <div class="d-flex justify-content ">
      <p class=" btn btn-warning"><a class="text-dark" href="{% url "product_list" %}"> بازگشت به صفحه اصلی </a></p>
    </div>
  <br/><br/>

{% endif %}








<script>
    // Update Cart
    
    $(document).on('click', '.update-cart', function(e){
      e.preventDefault();
      var productid = $(this).data('index');
    
      $.ajax({
          type: 'POST',
          url: '{% url "cart_update" %}' ,
          data: {
              product_id: $(this).data('index'),
              product_qty: $('#select' + productid).val(),
              csrfmiddlewaretoken: '{{ csrf_token }}',
              action: 'post'
          },
          success: function(json){
              $('#cart_quantity').text(json.qty);
              location.reload();
          },
          error: function(xhr, errmsg, err){
              console.error(error);
          }
      });
    });
    
    
    // Delete Item From Cart
    
    $(document).on('click', '.delete-product', function(e){
    e.preventDefault();
    
    
    $.ajax({
    type: 'POST',
    url: '{% url 'cart_delete' %}',
    data: {
    product_id: $(this).data('index'),
    csrfmiddlewaretoken: '{{ csrf_token }}',
    action: 'post'
    },
    success: function(json){
    location.reload();
    },
    
    error: function(xhr, errmsg, err){
    
    }
    
    
    });
    
    })
    
    
    
    
    </script>
    
    
    {% endblock %}